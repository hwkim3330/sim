<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¬ì´ - AI ìºë¦­í„° ì±—ë´‡</title>
    <meta name="description" content="ì‹¬ì´ì™€ ëŒ€í™”í•´ë³´ì„¸ìš”! ìˆœìˆ˜ JavaScript ì‹ ê²½ë§ ê¸°ë°˜ ìºë¦­í„° ì±—ë´‡">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ’¬</text></svg>">
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div class="app-container">
        <!-- Chat Panel -->
        <div class="chat-panel">
            <div class="chat-header">
                <span class="chat-header-icon">ğŸ’¬</span>
                <div class="chat-header-info">
                    <h1>ì‹¬ì´</h1>
                    <p>AI ìºë¦­í„° ì±—ë´‡</p>
                </div>
                <div class="chat-header-actions">
                    <button class="icon-btn" id="settings-btn" title="ì„¤ì •">âš™ï¸</button>
                    <button class="icon-btn" id="clear-chat" title="ëŒ€í™” ì§€ìš°ê¸°">ğŸ—‘ï¸</button>
                </div>
            </div>
            <div id="chat-container"></div>
        </div>

        <!-- Character Panel -->
        <div class="character-panel">
            <div id="character-container"></div>
        </div>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settings-panel">
        <h2>âš™ï¸ ì„¤ì •</h2>
        <div class="setting-row">
            <label>ìŒì„± ì¶œë ¥</label>
            <label class="toggle">
                <input type="checkbox" id="voice-toggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
    </div>

    <!-- Libraries -->
    <script src="lib/sim-nn.js"></script>
    <script src="lib/sim-nlp.js"></script>
    <script src="lib/sim-chat.js"></script>
    <script src="lib/sim-ui.js"></script>

    <script>
    (async function() {
        'use strict';

        // Initialize components
        const chatEngine = SimChat.create({ name: 'ì‹¬ì´' });
        const character = new SimUI.Character('#character-container');
        const voice = new SimUI.Voice({ enabled: true });

        let chatUI;

        // Handle send message
        async function handleSend(text) {
            chatUI.addMessage(text, 'user');
            character.startThinking();

            try {
                const result = await chatEngine.respond(text);
                character.stopThinking();
                chatUI.addMessage(result.response, 'assistant', result.emoji);
                character.react(result.emotion, result.response);

                if (document.getElementById('voice-toggle').checked) {
                    await voice.speak(result.response);
                }
            } catch (error) {
                character.stopThinking();
                chatUI.addMessage('ì•—, ì ê¹ ë¬¸ì œê°€ ìƒê²¼ì–´ìš”...', 'assistant', 'ğŸ˜…');
            }
        }

        // Handle voice input
        async function handleVoice() {
            if (!SimUI.isSTTSupported()) {
                alert('ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ìŒì„± ì¸ì‹ì´ ì§€ì›ë˜ì§€ ì•Šì•„ìš”.');
                return;
            }

            if (voice.isListening) {
                voice.stopListening();
                chatUI.setVoiceListening(false);
                return;
            }

            try {
                chatUI.setVoiceListening(true);
                character.showSpeech('ğŸ¤ ë“£ê³  ìˆì–´ìš”...', 0);

                const text = await voice.listen({
                    onInterim: (interim) => chatUI.setInput(interim)
                });

                chatUI.setVoiceListening(false);
                character.hideSpeech();

                if (text) {
                    chatUI.setInput('');
                    handleSend(text);
                }
            } catch (error) {
                chatUI.setVoiceListening(false);
                character.hideSpeech();
            }
        }

        // Initialize
        async function init() {
            // Initialize chat engine
            await chatEngine.initialize('data/responses/responses.json');

            // Create chat UI
            chatUI = new SimUI.ChatInterface('#chat-container', {
                placeholder: 'ì‹¬ì´ì—ê²Œ ë§í•´ë³´ì„¸ìš”...',
                onSend: handleSend,
                onVoice: handleVoice
            });

            // Show greeting
            setTimeout(async () => {
                const greeting = chatEngine.getGreeting();
                chatUI.addMessage(greeting, 'assistant', 'ğŸ‘‹');
                character.react('happy', greeting);

                if (document.getElementById('voice-toggle').checked) {
                    await voice.speak(greeting);
                }
            }, 500);

            // Settings toggle
            document.getElementById('settings-btn')?.addEventListener('click', () => {
                document.getElementById('settings-panel')?.classList.toggle('open');
            });

            // Clear chat
            document.getElementById('clear-chat')?.addEventListener('click', () => {
                chatUI.clear();
                chatEngine.clearHistory();
                const greeting = chatEngine.getGreeting();
                chatUI.addMessage(greeting, 'assistant', 'ğŸ‘‹');
                character.react('happy', greeting);
            });

            // Close settings on outside click
            document.addEventListener('click', (e) => {
                const panel = document.getElementById('settings-panel');
                const btn = document.getElementById('settings-btn');
                if (panel?.classList.contains('open') && !panel.contains(e.target) && e.target !== btn) {
                    panel.classList.remove('open');
                }
            });

            console.log('ì‹¬ì´ ì±—ë´‡ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!');
            console.log('Libraries:', { SimNN, SimNLP, SimChat, SimUI });
        }

        init();
    })();
    </script>
</body>
</html>
